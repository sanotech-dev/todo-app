const input = document.getElementById("todo-input");
const addBtn = document.getElementById("add-btn");
const list = document.getElementById("todo-list");
const filterBtns = document.querySelectorAll(".filters button");

// ذخیره دیتا در localStorage
function saveTodos() {
  const todos = [];
  document.querySelectorAll("#todo-list li").forEach(li => {
    todos.push({
      text: li.querySelector("span").innerText,
      completed: li.classList.contains("completed")
    });
  });
  localStorage.setItem("todos", JSON.stringify(todos));
}

// لود دیتا
function loadTodos() {
  const todos = JSON.parse(localStorage.getItem("todos")) || [];
  todos.forEach(t => addTodo(t.text, t.completed));
}

function addTodo(text, completed = false) {
  if (!text) return;

  const li = document.createElement("li");
  li.innerHTML = `
    <span>${text}</span>
    <button class="delete">x</button>
  `;

  if (completed) li.classList.add("completed");

  // toggle انجام شده
  li.addEventListener("click", (e) => {
    if (e.target.classList.contains("delete")) return;
    li.classList.toggle("completed");
    saveTodos();
  });

  // حذف
  li.querySelector(".delete").addEventListener("click", () => {
    li.remove();
    saveTodos();
  });

  list.appendChild(li);
  saveTodos();
}

addBtn.addEventListener("click", () => {
  addTodo(input.value);
  input.value = "";
});

input.addEventListener("keydown", (e) => {
  if (e.key === "Enter") {
    addTodo(input.value);
    input.value = "";
  }
});

// فیلترها
filterBtns.forEach(btn => {
  btn.addEventListener("click", () => {
    document.querySelector(".filters .active").classList.remove("active");
    btn.classList.add("active");

    const filter = btn.dataset.filter;
    document.querySelectorAll("#todo-list li").forEach(li => {
      switch (filter) {
        case "all":
          li.style.display = "block";
          break;
        case "active":
          li.style.display = !li.classList.contains("completed") ? "block" : "none";
          break;
        case "completed":
          li.style.display = li.classList.contains("completed") ? "block" : "none";
          break;
      }
    });
  });
});

// اجرا هنگام لود صفحه
loadTodos();
